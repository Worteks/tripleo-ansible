---
- project:
    templates:
    - tripleo-ansible-molecule-jobs
    - release-notes-jobs-python3
    - openstack-python3-ussuri-jobs
    check:
      jobs:
      - openstack-tox-linters
      - tripleo-ci-centos-7-content-provider: &content_provider_c7
          dependencies: &deps_lint
            - openstack-tox-linters
      - tripleo-ci-centos-8-content-provider: &content_provider
          dependencies: *deps_lint
      - openstack-tox-docs: &tripleo-docs
          files:
          - ^doc/.*
          - ^README.rst
      - tripleo-ci-centos-7-containers-multinode: &containers_multinode_c7
          vars: &multi_consumer_vars
            consumer_job: true
            build_container_images: false
            remove_tags:
              - build
          dependencies: &deps_cprovider_c7
            - tripleo-ci-centos-7-content-provider
          files: &multi_files
            - ^tripleo_ansible/.*
          irrelevant-files: &irrelevant_scenario_files
            - .*.md$
            - .*.rst$
            - .*.txt$
            - ^tripleo_ansible/.*molecule.*
            - ^tripleo_ansible/.*meta.*
            - ^tripleo_ansible/roles/test_deps/.*
      - tripleo-ci-centos-8-containers-multinode: &containers_multinode
          vars: *multi_consumer_vars
          dependencies: &deps_cprovider
            - tripleo-ci-centos-8-content-provider
          files: *multi_files
          irrelevant-files: *irrelevant_scenario_files
      - tripleo-ci-centos-8-scenario001-standalone: &scenario001
          vars: &sa_consumer_vars
            consumer_job: true
            build_container_images: false
            tags:
              - standalone
          dependencies: *deps_cprovider
          files:
            - ^tripleo_ansible/roles/tripleo-ceph-.*/.*
            - ^tripleo_ansible/roles/tripleo-hieradata/.*
            - ^tripleo_ansible/roles/tripleo-upgrade-hiera/.*
            - ^setup.*
          irrelevant-files: *irrelevant_scenario_files
      - tripleo-ci-centos-8-scenario002-standalone: &scenario002
          vars: *sa_consumer_vars
          dependencies: *deps_cprovider
          files:
            - ^tripleo_ansible/roles/tripleo-hieradata/.*
            - ^tripleo_ansible/roles/tripleo-upgrade-hiera/.*
          irrelevant-files: *irrelevant_scenario_files
      - tripleo-ci-centos-8-scenario003-standalone: &scenario003
          vars: *sa_consumer_vars
          dependencies: *deps_cprovider
          files:
            - ^tripleo_ansible/roles/tripleo-create-admin/.*
            - ^tripleo_ansible/roles/tripleo-hieradata/.*
            - ^tripleo_ansible/roles/tripleo-upgrade-hiera/.*
          irrelevant-files: *irrelevant_scenario_files
      - tripleo-ci-centos-8-scenario004-standalone: &scenario004
          vars: *sa_consumer_vars
          dependencies: *deps_cprovider
          files:
            - ^tripleo_ansible/roles/tripleo-ceph-.*/.*
          irrelevant-files: *irrelevant_scenario_files
      - tripleo-ci-centos-8-scenario010-standalone: &scenario010
          vars: *sa_consumer_vars
          dependencies: *deps_cprovider
          files:
            - ^tripleo_ansible/.*octavia.*
          irrelevant-files: *irrelevant_scenario_files
    gate:
      jobs:
      - openstack-tox-linters
      - tripleo-ci-centos-7-content-provider: *content_provider_c7
      - tripleo-ci-centos-8-content-provider: *content_provider
      - openstack-tox-docs: *tripleo-docs
      - tripleo-ci-centos-7-containers-multinode: *containers_multinode_c7
      - tripleo-ci-centos-8-containers-multinode: *containers_multinode
      - tripleo-ci-centos-8-scenario001-standalone: *scenario001
      - tripleo-ci-centos-8-scenario002-standalone: *scenario002
      - tripleo-ci-centos-8-scenario003-standalone: *scenario003
      - tripleo-ci-centos-8-scenario004-standalone: *scenario004
      - tripleo-ci-centos-8-scenario010-standalone: *scenario010
    post:
      jobs:
      - publish-openstack-python-branch-tarball
    promote:
      jobs:
      - promote-openstack-tox-docs: *tripleo-docs
